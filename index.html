<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JEE Ace Tutor - Gemini 2.5</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        .glass-panel { background: rgba(15, 15, 20, 0.9); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-bubble { background: rgba(30, 30, 35, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .neon-shadow { box-shadow: 0 0 15px rgba(0, 243, 255, 0.2); }
        .hidden-popup { display: none !important; }
        body { background-color: #050505; color: #e0e0e0; font-family: 'Inter', sans-serif; }
        input:focus { outline: none; }
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); opacity: 0.5; } 40% { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-[#111827] via-black to-black">

    <div id="api-popup" class="fixed inset-0 z-[1000] flex items-center justify-center bg-black/95 backdrop-blur-xl px-4">
        <div class="glass-panel p-8 rounded-3xl max-w-md w-full border-cyan-500/30 neon-shadow text-center">
            <div class="w-16 h-16 bg-cyan-500/10 rounded-2xl flex items-center justify-center mx-auto mb-6 border border-cyan-500/20">
                <i class="fa-solid fa-bolt-lightning text-cyan-400 text-2xl"></i>
            </div>
            <h2 class="text-2xl font-bold text-white mb-2 font-display">System Activation</h2>
            <p class="text-gray-400 text-sm mb-6">Enter your Gemini API key to unlock the JEE Ace Tutor.</p>
            <input type="password" id="api-key-input" placeholder="Paste API Key here..." 
                   class="w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-cyan-400 mb-4 text-center focus:border-cyan-500 transition-all">
            <button onclick="saveApiKey()" class="w-full bg-cyan-500 hover:bg-cyan-400 text-black font-bold py-3 rounded-xl transition-all shadow-lg">
                INITIALIZE CORE
            </button>
            <p class="text-[10px] text-gray-600 mt-4 italic">Stored locally. Never shared.</p>
        </div>
    </div>

    <header class="glass-panel px-6 py-4 flex items-center justify-between z-20">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-600 to-cyan-500 flex items-center justify-center shadow-lg">
                <i class="fa-solid fa-brain text-white"></i>
            </div>
            <div>
                <h1 class="text-xl font-bold text-white font-display tracking-tight">JEE ACE <span class="text-cyan-400 text-xs font-mono ml-1">v2.5</span></h1>
                <div class="flex items-center gap-2">
                    <span class="w-1.5 h-1.5 rounded-full bg-cyan-400 animate-pulse"></span>
                    <p class="text-[10px] text-cyan-400 font-bold uppercase tracking-widest">Active</p>
                </div>
            </div>
        </div>
        <button onclick="resetSystem()" class="text-gray-500 hover:text-red-400 transition-colors">
            <i class="fa-solid fa-power-off"></i>
        </button>
    </header>

    <main id="chat-container" class="flex-1 overflow-y-auto p-4 space-y-6 pb-32"></main>

    <footer class="fixed bottom-0 w-full p-4 bg-gradient-to-t from-black via-black/80 to-transparent">
        <div class="max-w-4xl mx-auto flex items-center gap-3 bg-[#0f0f0f] border border-white/10 rounded-2xl p-2 neon-shadow">
            <input type="file" id="file-input" accept="image/*" class="hidden">
            <button id="upload-btn" class="w-11 h-11 rounded-xl bg-gray-800 text-gray-400 flex items-center justify-center hover:text-cyan-400 transition-all">
                <i class="fa-solid fa-camera"></i>
            </button>
            <input type="text" id="user-input" placeholder="Type your question..." 
                   class="flex-1 bg-transparent border-none text-white text-sm px-2 focus:ring-0">
            <button id="send-btn" class="w-11 h-11 rounded-xl bg-cyan-500 text-black flex items-center justify-center hover:bg-cyan-400 transition-all">
                <i class="fa-solid fa-paper-plane"></i>
            </button>
        </div>
    </footer>

    <script>
        let GEMINI_KEY = localStorage.getItem('jee_ace_key');
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');

        // On Load
        window.onload = () => {
            if (!GEMINI_KEY) {
                document.getElementById('api-popup').classList.remove('hidden-popup');
            } else {
                document.getElementById('api-popup').classList.add('hidden-popup');
                addMessage("model", "Welcome back. System is ready for JEE analysis.");
            }
        };

        function saveApiKey() {
            const key = document.getElementById('api-key-input').value.trim();
            if (key.length > 20) {
                localStorage.setItem('jee_ace_key', key);
                GEMINI_KEY = key;
                document.getElementById('api-popup').classList.add('hidden-popup');
                addMessage("model", "Core initialized with Gemini 2.5 Flash.");
            } else {
                alert("Please enter a valid API key.");
            }
        }

        function resetSystem() {
            if(confirm("Wipe API key and history?")) {
                localStorage.removeItem('jee_ace_key');
                location.reload();
            }
        }

        async function callGemini(text, imageBase64 = null) {
            showTyping();
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_KEY}`;
            
            const parts = [{ text: text }];
            if (imageBase64) parts.push({ inlineData: { mimeType: "image/jpeg", data: imageBase64 } });

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ role: "user", parts: parts }],
                        systemInstruction: { parts: [{ text: "You are the JEE Ace Tutor. Provide detailed, expert JEE solutions using LaTeX and Markdown." }] }
                    })
                });
                const data = await response.json();
                removeTyping();
                addMessage("model", data.candidates[0].content.parts[0].text);
            } catch (e) {
                removeTyping();
                addMessage("model", "⚠️ Error connecting to Gemini. Please check your key.");
            }
        }

        function addMessage(role, content, isImage = false) {
            const div = document.createElement('div');
            div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            
            const bubbleClass = role === 'user' 
                ? 'bg-cyan-600 text-white rounded-tr-none' 
                : 'glass-bubble text-gray-200 rounded-tl-none';

            div.innerHTML = `
                <div class="max-w-[85%] p-4 rounded-2xl ${bubbleClass} shadow-lg">
                    <div class="prose prose-invert text-sm">
                        ${isImage ? `<img src="${content}" class="rounded-lg mb-2">` : marked.parse(content)}
                    </div>
                </div>
            `;
            chatContainer.appendChild(div);
            chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
            if (window.MathJax) MathJax.typeset();
        }

        function showTyping() {
            const div = document.createElement('div');
            div.id = 'typing';
            div.className = 'flex justify-start';
            div.innerHTML = `<div class="glass-bubble px-4 py-2 rounded-full flex gap-1"><div class="w-1.5 h-1.5 bg-cyan-400 rounded-full typing-dot"></div><div class="w-1.5 h-1.5 bg-cyan-400 rounded-full typing-dot"></div><div class="w-1.5 h-1.5 bg-cyan-400 rounded-full typing-dot"></div></div>`;
            chatContainer.appendChild(div);
        }

        function removeTyping() { document.getElementById('typing')?.remove(); }

        // Logic for input and send
        function handleSend() {
            const val = userInput.value.trim();
            if (!val) return;
            addMessage("user", val);
            userInput.value = '';
            callGemini(val);
        }

        sendBtn.addEventListener('click', handleSend);
        userInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') handleSend(); });

        // Image Upload
        document.getElementById('upload-btn').onclick = () => document.getElementById('file-input').click();
        document.getElementById('file-input').onchange = (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (event) => {
                addMessage("user", event.target.result, true);
                callGemini("Analyze this JEE question from the image.", event.target.result.split(',')[1]);
            };
            reader.readAsDataURL(file);
        };
    </script>
</body>
</html>
